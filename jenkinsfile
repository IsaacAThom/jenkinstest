pipeline {
    agent any

    stages {
        stage('Build') {
            steps {
                echo 'Compile the code and generate any necessary artifacts using Apache Maven'
            }
        }
        stage('Unit and Integration Tests') {
            steps {
                echo 'Test discrete components of the application using JUnit'
                echo 'Test how different components interact using Citrus'
            }
            post{
                success{
                    mail to: 'isaac.an.thompson@gmail.com',
                    subject: 'Unit and Integration Test Status',
                    body: 'Unit and Integration testing was a success'
                }
                failure{
                    mail to: 'isaac.an.thompson@gmail.com',
                    subject: 'Unit and Integration Test Status',
                    body: 'Unit and Integrating testing was a failure'
                }
            }
        }
        stage('Code Analysis') {
            steps {
                echo 'Analyse code to ensure it meeds standards using Code Climate Quality'
            }
        }
        stage('Security Scan') {
            steps {
                echo 'Perform a security scan using Bearer CLI'
            }
            post{
                success{
                    mail to: 'isaac.an.thompson@gmail.com',
                    subject: 'Security Scan Status',
                    body: 'Security scanning was a success'
                }
                failure{
                    mail to: 'isaac.an.thompson@gmail.com',
                    subject: 'Security Scan Status',
                    body: 'Security scanning was a failure'
                }
            } 
        }
        stage('Deploy to Staging') {
            steps {
                echo 'Deploy to staging server hosted on Amazon Elastic Compute Cloud'
            }
        }
        stage('Integration Tests on Staging') {
            steps {
                echo 'Run integration tests on the staging server'
            }
            post{
                success{
                    mail to: 'isaac.an.thompson@gmail.com',
                    subject: 'Integration Tests on Staging Status',
                    body: 'Integration tests on staging were a success'
                }
                failure{
                    mail to: 'isaac.an.thompson@gmail.com',
                    subject: 'Integration Tests on Staging Status',
                    body: 'Integrating tests on staging was a failure'
                }
            }
        }
        stage('Deploy to Production') {
            steps {
                echo 'Deploy to production server hosted on Amazon Elastic Compute Cloud'
            }
        }
    }
}
